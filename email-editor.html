<html>
	<head>
		<title>Chamaileon SDK - Thumbnails</title>
		<link rel="preconnect" href="https://fonts.gstatic.com">
		<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
		<link href="style.css" rel="stylesheet">

		<script src='https://plugins.chamaileon.io/static/chamaileonSdk.js'></script>
	</head>
	<body>
		<div>Chamaileon logo</div>
		<div id="card"></div>

		<script>
			(async function() {
			const apiKey = 'Y8mbu7S5Qh4cyCqJCVBn'
			const documentUrl = 'https://chamaileon-sdk.github.io/example-jsons/jsons/business-promo.json'

			const accessTokenRequest = await fetch('https://sdk-api.chamaileon.io/api/v1/tokens/generate', {
				method: 'GET',
				headers: {
					'Authorization': `Bearer ${apiKey}`,
				},
			})

			if (!accessTokenRequest.ok) {
				this.authErrorInfo = true

				return
			}

			const accessTokenResponse = await accessTokenRequest.json()
			const accessToken = accessTokenResponse.result

			const chamaileonPlugins = await chamaileonSdk.init({
				mode: 'serverless',
				accessToken,
				whitelabel: {
					urls: {
						splashScreen: 'https://chamaileon-sdk.github.io/splashscreen-and-logo-examples/splashScreen.html',
						createLogoJS: 'https://chamaileon-sdk.github.io/splashscreen-and-logo-examples/createLogo.js',
					},
					colors: {
						'primary': '#FF0000',
						'secondary': '#009f4a',
						'red': '#ff5546',
						'darkBlue': '#2d3291',
						'darkGreen': '#00af6e',
						'lightGreen': '#50d791',
						'weirdGreen': '#50d791',
						'pink': '#ff91a0',
						'yellow': '#ffd23c',
					}
				}
			})

			const documentResponse = await fetch(documentUrl, { method: 'GET' })
			const documentJson = await documentResponse.json()

			const userData = {
				name: 'John',
				avatar: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRgVUEjaWnHvhNaEy1-Jl6Ljvi7ahounqegSQ',
			}

			const variables = [
				{
					'type': 'color',
					'name': '$primaryColor',
					'value': '#4491A2'
				},
				{
					'type': 'image',
					'name': '$linkedinIcon',
					'value': 'https://cdn2.iconfinder.com/data/icons/social-media-2285/512/1_Linkedin_unofficial_colored_svg-128.png'
				},
				{
					'type': 'text',
					'name': '$welcomeText',
					'value': 'Hello World!'
				}

			]

			let emailJsonToLoad = { // starting with an empty email
					'eid' : 'root',
					'type' : 'body',
					'children' : [],
					'attrs' : {
						'usedColors' : [
							'#595959',
							'#000000',
							'#cccccc',
							'#cc0000',
							'#FCFCFC',
							'#5555ff',
							'#FDFDFD',
							'#FBFBFB',
							'#999999',
							'#f2f2f2',
							'#ffffff'
						]
					},
					'style' : {
						'background-color' : '#FFFFFF',
						'background-position' : 'center center',
						'background-repeat' : 'no-repeat'
					},
					'version' : '2.0.0'
				}

			const editorInstance = await chamaileonPlugins.editEmail({
					title: 'Test Email',
					user: userData,
					document: {
						title: "test",
						variables,
						body: documentJson.body
					},
					hooks: {
					},
					dropdownButtons: [
						{
							id: 'test-button-1',
							label: 'Show preview',
							icon: 'short_text',
						},
						{
							id: 'test-button-2',
							label: 'Get emailJson',
							icon: 'short_text',
						},
						{
							id: 'test-button-3',
							label: 'Generate html',
							icon: 'short_text',
						},
					],
					blockLibraries: [
						{
							id: 'email-blocks',
							label: 'Email\'s blocks',
							accessLevel: 'readWrite'
						},
						{
							id: 'john-doe-favs',
							label: 'John Doe\'s Favorite Blocks',
							accessLevel: 'readOnly'
						}
					],
					textInsertPluginButtons: [
						{
							label: 'Merge tags',
							id: 'merge-tags',
						}
					],
					canLockBlocks: true,
					autoSaveInterval: 15000,
				})
		}())


		</script>
	</body>
</html>